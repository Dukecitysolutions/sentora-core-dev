<style>


/* Style all input fields */
input {
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  margin-top: 6px;
  margin-bottom: 16px;
}

/* Style the submit button */
input[type=submit] {
  background-color: #4CAF50;
  color: white;
}

/* Style the container for inputs */
.check_container {
  background-color: #f1f1f1;
  padding: 0px;
}

/* The message box is shown when the user clicks on the password field */
#message {
  display:none;
  background: #f1f1f1;
  color: #000;
  position: relative;
  padding: 20px;
  margin-top: 5px;
}

#message p {
  padding: 0px 35px;
  font-size: 14px;
}

/* Add a green text color and a checkmark when the requirements are right */
.valid {
  color: green;
}

.valid:before {
  position: relative;
  left: -35px;
  content: "\2714";
}

/* Add a red text color and an "x" icon when the requirements are wrong */
.invalid {
  color: red;
}

.invalid:before {
  position: relative;
  left: -35px;
  content: "\2718";
}

</style>

<div class="zmodule_content panel" id="zmodule_header_<@ ModuleName @>">
    <div class="panel-heading">
        <img src="<@ ModuleIcon @>" width="35" height="35" border="0" alt="<@ ModuleName @>">

        <div class="zmodule_title">
            <@ ModuleName @>
        </div>

        <div class="zmodule_desc" id="zmodule_desc_<@ ModuleName @>"><@ ModuleDesc @></div>

    </div>

    <@ Result @>

    <% if isDeleteUser %>
    <div class="zform_wrapper alert alert-danger">
        <h2><: Delete User :>: <@ EditCurrentUserName @> ?</h2>
        <p><: Please confirm that you want to delete this MySQL user. :></p>
        <form action="./?module=mysql_users&action=ConfirmDeleteUser" method="post">
            <table class="none" cellpadding="0" cellspacing="0">
                <tr>
                    <td colspan="2" align="right">
                        <input type="hidden" name="inDelete" value="<@ EditCurrentUserID @>">
                        <button class="button-loader delete btn btn-danger" type="submit" ><: Delete :></button>
                        <button class="button-loader btn btn-default" type="button" onclick="window.location.href='./?module=mysql_users';return false;"><: Cancel :></button>
                    </td>
                </tr>
            </table>
            <@ CSFR_Tag @>
        </form>
    </div>
    <% endif %>

    <% if isEditUser %>
    <div class="zgrid_wrapper">
        <h2><: Databases for user :>: <@ EditCurrentUserName @></h2>
        <% if UserDatabaseList %>
        <form action="./?module=mysql_users&action=RemoveDB" method="post">
            <table class="table table-striped">
                <tr>
                    <th><: Database name :></th>
                    <th><: Remove from user :></th>
                </tr>
                <% loop UserDatabaseList %>
                <tr>
                    <td><& mmdbname &></td>
                    <td><button class="button-loader delete btn btn-danger" type="submit" name="inRemove_<& mmid &>" id="inRemove_<& mmid &>" value="<& mmid &>"><: Remove database :></button></td>
                </tr>
                <% endloop %>
                <input type="hidden" name="inUser" value="<@ EditCurrentUserID @>">
            </table>
            <@ CSFR_Tag @>
        </form>
        <% else %>
        <: This user currently has no databases. Assign a database using the form below. :>
        <% endif %>

        <p>&nbsp;</p>

        <h2><: Add Database :></h2>
        <form action="./?module=mysql_users&action=AddDB" method="post">
            <table class="table table-striped">
                <tr>
                    <th nowrap="nowrap"><: Database :>:</th>
                    <td width="250px">
                        <select name="inDatabase" id="inDatabase">
                            <option value="" selected="selected">-- Select a database --</option>
                            <% if DatabaseList %>
                            <% loop DatabaseList %>
                            <option value="<& mysqlid &>"><& mysqlname &></option>
                            <% endloop %>
                            <% endif %>
                        </select>
                    </td>
                    <td>
                        <input type="hidden" name="inUser" value="<@ EditCurrentUserID @>">
                        <button class="button-loader btn btn-primary" type="submit" ><: Add Database :></button>
                    </td>
                </tr>
            </table>
            <@ CSFR_Tag @>
        </form>

        <p>&nbsp;</p>

        <h2><: Reset Password :></h2>
        <form action="./?module=mysql_users&action=ResetPW" method="post">
            <table class="zform">
                <tr>
                    <th nowrap="nowrap"><: Password :>:</th>
                    <td width="250px">
                        <input class="inPassword" type="text" name="inResetPW" id="inPassword" value="" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" required />
                    </td>
					<td><input id="showPassword" type="checkbox" onclick="passwordShowHide()" >Show Password</td>
					<td style="width:20px"></td>
                    <td>
                        <input type="hidden" name="inUser" value="<@ EditCurrentUserID @>">
                        <button class="button-nonloader btn btn-primary" type="submit" ><: Save Password :></button>
                        <button class="button-loader btn btn-default" type="button" onclick="window.location.href='./?module=mysql_users';return false;"><: Cancel :></button>
                    </td>
                </tr>
                <tr>
                    <th></th>
                    <td><a href="#" class="link-password" id="generate" onclick="passwordShow(), check()" ><: Generate Password :></a></td>
                    <td></td>
                </tr>
            </table>
			
			<div class="check_container">
				<div id="message">
					<h4>Password must contain the following:</h4>
					<p id="letter" class="invalid">A <b>lowercase</b> letter</p>
					<p id="capital" class="invalid">A <b>capital (uppercase)</b> letter</p>
					<p id="number" class="invalid">A <b>number</b></p>
					<p id="length" class="invalid">Minimum <b>8 characters</b></p>
				</div>
			</div>
			
            <@ CSFR_Tag @>
        </form>

    </div>
    <% endif %>

    <div class="zgrid_wrapper">
        <h2><: Current MySQL&reg; Users :></h2>
        <% if UserList %>
        <form action="./?module=mysql_users&action=EditUser" method="post">
            <table class="table table-striped">
                <tr>
                    <th><: User name :></th>
                    <th><: Access :></th>
                    <th><: Databases :></th>
                    <th><: Password :></th>
					<th id="ColPass" style="visibility:visiable" ><button class="button btn btn-default" id="btn_sh">Show Passwords</button></th>
                    <th></th>
                </tr>
                <% loop UserList %>
                <tr>
                    <td><& username &></td>
                    <td><& accesshtml &></td>
                    <td><& totaldb &></td>
                    <td><span class="passRow" style="visibility: collapse"><& dbpassword &></td>
                    <td>
                        <button class="button-loader btn btn-default" type="submit" name="inEdit_<& userid &>" id="inEdit_<& userid &>" value="<& userid &>"><: Edit :></button>
                        <button class="button-loader delete btn btn-danger" type="submit" name="inDelete_<& userid &>" id="inDelete_<& userid &>" value="<& userid &>"><: Delete :></button>
                    </td>
                </tr>
                <% endloop %>
            </table>
            <@ CSFR_Tag @>
        </form>
        <% else %>
        <: You have no MySQL&reg; users at this time. Create a user using the form below. :>
        <% endif %>
    </div>

    <% if isCreateUser %>
    <div class="zform_wrapper">
        <table class="none" width="100%" cellborder="0" cellspacing="0">
            <tr valign="top">
                <td>
                    <h2><: Create a new MySQL&reg; User :></h2>
                    <form action="./?module=mysql_users&action=CreateUser" method="post">
                        <table class="table table-striped">
                            <tr>
                                <th nowrap="nowrap"><: User name :>:</th>
                                <td nowrap="nowrap"><input type="text" size="30" name="inUserName" id="inUserName" /></td>
                            </tr>
                            <tr>
                                <th nowrap="nowrap"><: Map Database :>:</th>
                                <td>
                                    <select name="inDatabase" id="inDatabase">
                                        <option value="" selected="selected">-- Select a database --</option>
                                        <% if DatabaseList %>
                                        <% loop DatabaseList %>
                                        <option value="<& mysqlid &>"><& mysqlname &></option>
                                        <% endloop %>
                                        <% endif %>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th nowrap="nowrap"><: Remote Access :>:</th>
                                <td><input name="inAccess" type="radio" id="inAccess" value="1" onclick="hide_div('showaccess');" CHECKED />&nbsp;<: Allow from any IP :></td>
                            </tr>
                            <tr>
                                <th>&nbsp;</th>
                                <td><input name="inAccess" type="radio" id="inAccess" value="2" onclick="show_div('showaccess');" />&nbsp;<: Only from single IP :></td>
                            </tr>
                            <tr>
                                <th>&nbsp;</th>
                                <td>
                                    <div id="showaccess" style="display:none;">
                                        <input type="text" size="30" name="inAccessIP" id="inAccessIP" />
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th colspan="2" align="right">
                                    <button class="button-loader btn btn-primary" type="submit" ><: Create :></button></th>
                            </tr>
                        </table>
                        <@ CSFR_Tag @>
                    </form>
                </td>
                <td align="right"><@ MysqlUsagepChart @></td>
            </tr></table>
    </div>
    <% endif %>

</div>

<script type="text/javascript">
    <!--
    function show_div(id) {
        var e = document.getElementById(id);
        if(e.style.display == 'none')
            e.style.display = 'block';
    }
    //-->
</script>
<script type="text/javascript">
    <!--
    function hide_div(id) {
        var e = document.getElementById(id);
        if(e.style.display == 'block')
            e.style.display = 'none';
    }
    //-->
</script>
<script type="text/JavaScript">
    $.extend({
        password: function (length, special) {
            var iteration = 0;
            var password = "";
            var randomNumber;
            if(special == undefined){
                var special = false;
            }
            while(iteration < length){
                randomNumber = (Math.floor((Math.random() * 100)) % 94) + 33;
                if(!special){
                    if ((randomNumber >=33) && (randomNumber <=47)) { continue; }
                    if ((randomNumber >=58) && (randomNumber <=64)) { continue; }
                    if ((randomNumber >=91) && (randomNumber <=96)) { continue; }
                    if ((randomNumber >=123) && (randomNumber <=126)) { continue; }
                }
                iteration++;
                password += String.fromCharCode(randomNumber);
            }
            return password;
        }
    });
    $(document).ready(function() {
        $('.link-password').click(function(e){
            linkId = $(this).attr('id');
            if (linkId == 'generate'){
                password = $.password(16,false);
                $('.inPassword').val(password);
            }
            e.preventDefault();
        });
    });
	
	
    $(document).ready(function() {
		var ShowPass = false;
        $('.link-password').click(function(e){
            linkId = $(this).attr('id');
            if (linkId == 'generate'){
                password = $.password(16,false);
                $('.inPassword').val(password);
            }
            e.preventDefault();
        });
		$('#btn_sh').click(function(e){
		  if (!ShowPass)
		  { 
			  $('.passRow').css({'visibility': 'visible'});
			  $('#btn_sh').innerHTML = 'Hide passwords';
			  ShowPass = true;
		  }
		  else 
		  {
			  $('.passRow').css({'visibility': 'collapse'});
			  $('#btn_sh').innerHTML = 'Show passwords';
			  ShowPass = false;
		  }
		  e.preventDefault();
		});
		
	  
    });

</script>

<script type="text/JavaScript">
	
	var myInput = document.getElementById("inPassword");
	var letter = document.getElementById("letter");
	var capital = document.getElementById("capital");
	var number = document.getElementById("number");
	var length = document.getElementById("length");
	
	// When the user clicks on the password field, show the message box
	myInput.onfocus = function() {
	  	document.getElementById("message").style.display = "block";
	}
	
	// When the user clicks outside of the password field, hide the message box
	myInput.onblur = function() {
	  	document.getElementById("message").style.display = "none";
	}
	
	// When the user starts to type something inside the password field
	myInput.onclick = function() {
		  // Validate lowercase letters
		  var lowerCaseLetters = /[a-z]/g;
		  if(myInput.value.match(lowerCaseLetters)) {
			letter.classList.remove("invalid");
			letter.classList.add("valid");
		  } else {
			letter.classList.remove("valid");
			letter.classList.add("invalid");
	}
	
	  // Validate capital letters
	  var upperCaseLetters = /[A-Z]/g;
	  if(myInput.value.match(upperCaseLetters)) {
			capital.classList.remove("invalid");
			capital.classList.add("valid");
	  } else {
			capital.classList.remove("valid");
			capital.classList.add("invalid");
	  }
	
	  // Validate numbers
	  var numbers = /[0-9]/g;
	  if(myInput.value.match(numbers)) {
			number.classList.remove("invalid");
			number.classList.add("valid");
	  } else {
			number.classList.remove("valid");
			number.classList.add("invalid");
	  }
	
	  // Validate length
	  if(myInput.value.length >= 8) {
			length.classList.remove("invalid");
			length.classList.add("valid");
	  } else {
			length.classList.remove("valid");
			length.classList.add("invalid");
	  }
	}
	
	
	// When the user clicks inside the password field
	myInput.onkeyup = function() {
		  // Validate lowercase letters
		  var lowerCaseLetters = /[a-z]/g;
		  if(myInput.value.match(lowerCaseLetters)) {
			letter.classList.remove("invalid");
			letter.classList.add("valid");
		  } else {
			letter.classList.remove("valid");
			letter.classList.add("invalid");
	}
	
	  // Validate capital letters
	  var upperCaseLetters = /[A-Z]/g;
	  if(myInput.value.match(upperCaseLetters)) {
			capital.classList.remove("invalid");
			capital.classList.add("valid");
	  } else {
			capital.classList.remove("valid");
			capital.classList.add("invalid");
	  }
	
	  // Validate numbers
	  var numbers = /[0-9]/g;
	  if(myInput.value.match(numbers)) {
			number.classList.remove("invalid");
			number.classList.add("valid");
	  } else {
			number.classList.remove("valid");
			number.classList.add("invalid");
	  }
	
	  // Validate length
	  if(myInput.value.length >= 8) {
			length.classList.remove("invalid");
			length.classList.add("valid");
	  } else {
			length.classList.remove("valid");
			length.classList.add("invalid");
	  }
	}
	
</script>

<script>

function passwordShowHide() {
  var x = document.getElementById("inPassword");
  if (x.type === "password") {
    x.type = "text";
  } else {
    x.type = "password";
  }
}

function passwordShow() {
  var x = document.getElementById("inPassword");
  if (x.type === "password") {
    x.type = "text";
  } 
}

function check() {
  document.getElementById("showPassword").checked = true;
}
function uncheck() {
  document.getElementById("showPassword").checked = false;
}

</script>
